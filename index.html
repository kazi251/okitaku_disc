<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8">
  <title>ã‚¯ãƒˆã‚¥ãƒ«ãƒ•TRPG ãƒ„ãƒ¼ãƒ«</title>
  <style>
    body { font-family: sans-serif; padding: 20px; }
    textarea, input { width: 100%; margin-bottom: 10px; padding: 8px; }
    #suggestions {
      border: 1px solid #ccc;
      max-height: 150px;
      overflow-y: auto;
      margin-top: -10px;
      margin-bottom: 10px;
      background: white;
      position: relative;
      z-index: 10;
    }
    #suggestions div {
      padding: 5px;
      cursor: pointer;
      border-bottom: 1px solid #eee;
    }
    #suggestions div:hover {
      background: #eef;
    }
  </style>
</head>
<body>

  <h2>ã‚»ãƒªãƒ•é€ä¿¡ï¼ˆæ¢ç´¢è€… å¤ªéƒï¼‰</h2>
  <input type="text" id="say-text" placeholder="ã‚»ãƒªãƒ•ã‚’å…¥åŠ›">
  <button onclick="sendSay()">é€ä¿¡</button>

  <h2>ãƒ€ã‚¤ã‚¹ã‚³ãƒãƒ³ãƒ‰å®Ÿè¡Œ</h2>
  <input type="text" id="dice-command" placeholder="ä¾‹: CCB<=75" oninput="showSuggestions()">
  <div id="suggestions"></div>
  <button onclick="rollDice()">ãƒ€ã‚¤ã‚¹å®Ÿè¡Œ</button>
  <div id="dice-result">ğŸ² çµæœãŒã“ã“ã«è¡¨ç¤ºã•ã‚Œã¾ã™</div>

  <h2>ãƒãƒ£ãƒƒãƒˆãƒ‘ãƒ¬ãƒƒãƒˆï¼ˆè²¼ã‚Šä»˜ã‘ã¦ä¿å­˜ï¼‰</h2>
  <textarea id="chat-palette" rows="10" placeholder="ãƒãƒ£ãƒƒãƒˆãƒ‘ãƒ¬ãƒƒãƒˆã‚’ã“ã“ã«è²¼ã‚Šä»˜ã‘ã¦ãã ã•ã„"></textarea>
  <button onclick="savePalette()">ä¿å­˜</button>

  <script>
    const diceWorkerUrl = "https://rollworker.kai-chan-tsuru.workers.dev/";
    const sayWorkerUrl = "https://sayworker.kai-chan-tsuru.workers.dev/";

    function sendSay() {
      const content = document.getElementById("say-text").value;
      if (!content) return alert("ã‚»ãƒªãƒ•ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„");
      fetch(sayWorkerUrl, {
        method: "POST",
        body: JSON.stringify({ content }),
      });
      document.getElementById("say-text").value = "";
    }

    async function rollDice() {
      const command = document.getElementById("dice-command").value;
      if (!command) return alert("ãƒ€ã‚¤ã‚¹ã‚³ãƒãƒ³ãƒ‰ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„");
      const url = new URL(diceWorkerUrl);
      url.searchParams.set("command", command);
      url.searchParams.set("say", "true");

      try {
        const res = await fetch(url.toString());
        const data = await res.json();
        document.getElementById("dice-result").innerText = `ğŸ² çµæœ: ${data.ok ? data.text : "ã‚¨ãƒ©ãƒ¼: " + data.reason}`;
      } catch (e) {
        document.getElementById("dice-result").innerText = "âš ï¸ é€šä¿¡ã‚¨ãƒ©ãƒ¼";
      }
    }

    function savePalette() {
      const raw = document.getElementById("chat-palette").value;
      const lines = raw.split("\n").map(line => line.trim()).filter(line => line);
      localStorage.setItem("palette", JSON.stringify(lines));
      alert("ä¿å­˜ã—ã¾ã—ãŸï¼");
    }

    function showSuggestions() {
      const input = document.getElementById("dice-command").value.toLowerCase();
      const suggestions = document.getElementById("suggestions");
      suggestions.innerHTML = "";
      if (!input) return;

      const palette = JSON.parse(localStorage.getItem("palette") || "[]");
      const matches = palette.filter(line => line.toLowerCase().includes(input));
      matches.forEach(match => {
        const div = document.createElement("div");
        div.textContent = match;
        div.onclick = () => {
          document.getElementById("dice-command").value = match;
          suggestions.innerHTML = "";
        };
        suggestions.appendChild(div);
      });
    }
  </script>
</body>
</html>
