<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8">
  <title>ã‚¯ãƒˆã‚¥ãƒ«ãƒ•TRPGãƒ„ãƒ¼ãƒ«</title>
  <style>
    body {
      font-family: sans-serif;
      margin: 20px;
    }
    #result {
      margin-top: 10px;
    }
    #suggestions {
      border: 1px solid #ccc;
      max-height: 120px;
      overflow-y: auto;
      position: absolute;
      background: white;
      width: 300px;
      display: none;
    }
    #suggestions div {
      padding: 4px;
      cursor: pointer;
    }
    #suggestions div:hover {
      background-color: #eee;
    }
    #chat-palette {
      margin-top: 40px;
    }
  </style>
</head>
<body>

<h2>ãƒ€ã‚¤ã‚¹ãƒ­ãƒ¼ãƒ«</h2>
<input type="text" id="dice-command" placeholder="ã‚³ãƒãƒ³ãƒ‰ã‚’å…¥åŠ›ã¾ãŸã¯æ¤œç´¢" oninput="showSuggestions()" autocomplete="off" style="width: 300px;">
<div id="suggestions"></div>
<button onclick="rollDice()">ãƒ€ã‚¤ã‚¹å®Ÿè¡Œ</button>
<div id="result">ğŸ² çµæœãŒã“ã“ã«è¡¨ç¤ºã•ã‚Œã¾ã™</div>

<h2>ã‚»ãƒªãƒ•é€ä¿¡</h2>
<textarea id="say-content" rows="3" cols="40" placeholder="ã‚»ãƒªãƒ•ã‚’å…¥åŠ›..."></textarea><br>
<button onclick="sendSay()">é€ä¿¡</button>

<div id="chat-palette">
  <h2>ãƒãƒ£ãƒƒãƒˆãƒ‘ãƒ¬ãƒƒãƒˆè²¼ã‚Šä»˜ã‘æ¬„</h2>
  <textarea id="palette-input" rows="15" cols="60" placeholder="ãƒãƒ£ãƒƒãƒˆãƒ‘ãƒ¬ãƒƒãƒˆã‚’ã“ã“ã«è²¼ã‚Šä»˜ã‘ã¦ãã ã•ã„"></textarea><br>
  <button onclick="savePalette()">ä¿å­˜</button>
</div>

<script>
  const paletteKey = "chatPalette";
  let chatPalette = [];

  function savePalette() {
    const raw = document.getElementById("palette-input").value;
    chatPalette = raw.split("\n").filter(line => line.trim());
    localStorage.setItem(paletteKey, JSON.stringify(chatPalette));
    alert("ä¿å­˜ã—ã¾ã—ãŸï¼");
  }

  function loadPalette() {
    const saved = localStorage.getItem(paletteKey);
    if (saved) {
      chatPalette = JSON.parse(saved);
      document.getElementById("palette-input").value = chatPalette.join("\n");
    }
  }

  function showSuggestions() {
    const input = document.getElementById("dice-command").value.toLowerCase();
    const suggestions = document.getElementById("suggestions");
    suggestions.innerHTML = "";

    if (!input) {
      suggestions.style.display = "none";
      return;
    }

    const matches = chatPalette.filter(line => line.toLowerCase().includes(input));
    if (matches.length === 0) {
      suggestions.style.display = "none";
      return;
    }

    matches.forEach(match => {
      const div = document.createElement("div");
      div.textContent = match;
      div.onclick = () => {
        document.getElementById("dice-command").value = match;
        suggestions.style.display = "none";
      };
      suggestions.appendChild(div);
    });

    suggestions.style.display = "block";
  }

async function rollDice() {
  const command = document.getElementById("dice-command").value.trim();
  if (!command) {
    alert("ã‚³ãƒãƒ³ãƒ‰ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„");
    return;
  }

  const workerUrl = new URL("https://rollworker.kai-chan-tsuru.workers.dev/");
  workerUrl.searchParams.append("command", command);

  try {
    const response = await fetch(workerUrl.toString());
    const result = await response.json();
    const text = result.ok ? result.text : "ã‚¨ãƒ©ãƒ¼: " + result.reason;
    document.getElementById("result").innerText = `ğŸ² çµæœ: ${text}`;

    // æˆåŠŸã—ãŸã‚‰Discordã¸é€ä¿¡
    if (result.ok) {
      await fetch("https://sayworker.kai-chan-tsuru.workers.dev", {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify({
          usr: "æ¢ç´¢è€… å¤ªéƒ",
          content: text
        })
      });
    }
  } catch (error) {
    document.getElementById("result").innerText = "âš ï¸ é€šä¿¡ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã—ãŸ";
    console.error("Fetch error:", error);
  }
}


async function sendSay() {
  const content = document.getElementById("say-content").value.trim();
  if (!content) {
    alert("ã‚»ãƒªãƒ•ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„");
    return;
  }

  try {
    const response = await fetch("https://sayworker.kai-chan-tsuru.workers.dev", {
      method: "POST",
      headers: { "Content-Type": "application/json" },
      body: JSON.stringify({
        usr: "æ¢ç´¢è€… å¤ªéƒ",
        content
      })
    });

    if (!response.ok) {
      throw new Error("é€ä¿¡å¤±æ•—");
    }

    document.getElementById("say-content").value = "";
    alert("é€ä¿¡ã—ã¾ã—ãŸï¼");
  } catch (error) {
    alert("ã‚»ãƒªãƒ•é€ä¿¡ä¸­ã«ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã—ãŸ");
    console.error(error);
  }
}


  loadPalette();
</script>
2337
</body>
</html>
